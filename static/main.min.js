"use strict";(async function(){const a=async(a,b="GET",c)=>{const{protocol:d,hostname:e,port:f}=window.location,g=await window.fetch(`${d}//${e}:${f||80}/api${a}`,{method:b,headers:{Accept:"application/json","Content-Type":"application/json"},body:c?JSON.stringify(c):null});if(200!==g.status)throw new Error((await g.json()));else return g.json()},b=({text:a,status:b,_id:c})=>{document.getElementById("tasks").insertAdjacentHTML("beforeend",`<div class="tasks-single" ${"active"===b?"":"data-done"} data-todoid=${c}><div class="tasks-single-checkbox"></div><span class="tasks-single-desc">${a}</span><svg class="tasks-trash" viewBox="0 0 459 459"><path d="M76.5,408c0,28.05,22.95,51,51,51h204c28.05,0,51-22.95,51-51V102h-306V408z M408,25.5h-89.25L293.25,0h-127.5l-25.5,25.5    H51v51h357V25.5z" /></svg></div>`)},c=async()=>{try{const c=await a("/todos");for(let a of c)b(a);document.getElementById("user")&&document.getElementById("user").remove()}catch(a){window.alert(a.message)}};if(document.forms.addTask.addEventListener("submit",async function(c){c.preventDefault();try{const c=await a("/todos","POST",{text:this.text.value});b(c),this.text.value=""}catch(a){window.alert(a.message)}}),document.getElementById("tasks").addEventListener("click",async b=>{if(b.target&&b.target.closest(".tasks-single-checkbox")){const{todoid:c,done:d}=b.target.closest(".tasks-single").dataset;try{await a(`/todos/${c}`,"PUT",{status:void 0===d?"done":"active"}),void 0===d?document.querySelector(`#tasks .tasks-single[data-todoid="${c}"]`).dataset.done="":delete document.querySelector(`#tasks .tasks-single[data-todoid="${c}"]`).dataset.done}catch(a){window.alert(a.message)}}}),document.getElementById("tasks").addEventListener("click",async b=>{if(b.target&&b.target.closest(".tasks-trash")){const{todoid:c}=b.target.closest(".tasks-single").dataset;try{await a(`/todos/${c}`,"DELETE"),document.querySelector(`#tasks .tasks-single[data-todoid="${c}"]`).remove()}catch(a){window.alert(a.message)}}}),document.forms.register.addEventListener("submit",async function(b){b.preventDefault();try{await a("/users","POST",{name:this.name.value,email:this.email.value,password:this.password.value}),c()}catch(a){window.alert(a.message)}}),document.forms.login.addEventListener("submit",async function(b){b.preventDefault();try{await a("/auth","POST",{email:this.email.value,password:this.password.value}),c()}catch(a){window.alert(a.message)}}),document.getElementById("logout").addEventListener("click",async()=>{try{await a("/logout"),window.location.reload()}catch(a){window.alert(a.message)}}),document.cookie.includes("login-token"))try{await a("/auth"),c()}catch(a){window.alert(a.message)}})();
